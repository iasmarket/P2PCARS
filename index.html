<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>P2P-CARS - Trouvez Votre Voiture d'Occasion Idéale</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
  <style>
    body {
      background: linear-gradient(to bottom, rgba(15, 23, 42, 0.301), rgba(30, 41, 59, 0.247)),
      url('arier.png') no-repeat center center fixed;
      background-size: cover;
      color: #e2e8f0;
      font-family: 'Poppins', sans-serif;
      min-height: 100vh;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
    }
    header {
      background: rgba(255,255,255,0.07);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 18px;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 14px 10px 20px 10px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.35);
      gap: 40px;
    }
    header img {
      max-height: 110px;
      width: auto;
      object-fit: contain;
      transition: transform 0.3s;
    }
    header img:hover { transform: scale(1.05);}
    header .header-center {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }
    header h1 {
      font-size: 2.4rem;
      font-weight: 700;
      color: #e98a1e;
      margin-bottom: 0.3em;
    }
    header .text-h {
      font-size: 1.1rem;
      color: #effafa;
      letter-spacing: 0.5px;
    }
    @media (max-width: 750px) {
      header { flex-direction: column; gap: 12px;}
      header img { max-width: 70%;}
    }
    .navbar {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
      margin-top: 1rem;
      justify-content: center;
    }
    .lang-btns {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }
    .lang-btns button {
      width: 34px; height: 34px;
      border-radius: 50%;
      border: 2px solid #3b82f6;
      background: #1e293b;
      color: #3b82f6;
      font-weight: bold;
      cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      transition: background 0.3s;
      font-size: 1rem;
    }
    .lang-btns button.active, .lang-btns button:hover { background: #3b82f6; color: #fff;}
    .home-btn {
      margin-left: 0.7rem;
      background: #fff;
      color: #1e293b;
      border-radius: 20px;
      padding: 8px 16px;
      border: none;
      font-weight: 600;
      font-size: 1rem;
      text-decoration: none;
      box-shadow: 0 2px 4px rgba(0,0,0,0.07);
      transition: background 0.2s, color 0.2s;
    }
    .home-btn:hover { background: #3b82f6; color: #fff;}
    footer {
      text-align:center;
      margin: 20px 0 0 0;
      color: #e2e8f0;
      background: rgba(255,255,255,0.06);
      border-radius: 15px;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.15);
      padding: 16px;
      font-size: 0.97rem;
    }
    .header-nav {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      padding: 12px 20px;
      border-radius: 12px;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 30px;
    }
    .header-nav a {
      color: #3bf6e6;
      font-weight: 500;
      text-decoration: none;
      padding: 10px 16px;
      border-radius: 8px;
      transition: background 0.3s ease;
    }
    .header-nav a:hover {
      background: rgba(115, 59, 246, 0.562);
    }
    .welcome-section {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(12px);
      padding: 40px 30px;
      border-radius: 16px;
      text-align: center;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);
      margin-bottom: 30px;
      transition: transform 0.3s ease;
    }
    .welcome-section:hover {
      transform: translateY(-5px);
    }
    .welcome-section h2 {
      font-size: 2.5rem;
      font-weight: 700;
      color: #3b82f6;
      margin-bottom: 15px;
    }
    .welcome-section p {
      font-size: 1.2rem;
      color: #eaecf0;
      margin-bottom: 25px;
    }
    .welcome-section button {
      background: #3b82f6;
      color: #ffffff;
      font-size: 1.1rem;
      font-weight: 600;
      padding: 12px 28px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.2s ease;
    }
    .welcome-section button:hover {
      background: #2563eb;
      transform: scale(1.05);
    }
    .filters {
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(10px);
      padding: 20px;
      border-radius: 12px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
      color: #e2e8f0;
    }
    .filters label {
      font-size: 0.9rem;
      margin-bottom: 4px;
      display: block;
    }
    .filters input,
    .filters select {
      padding: 10px;
      background: #1e293b;
      color: #e2e8f0;
      border: 1px solid #3b82f6;
      border-radius: 8px;
      font-size: 0.95rem;
    }
    .filters input:focus,
    .filters select:focus {
      outline: none;
      border-color: #3b82f6;
    }
    .car-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 25px;
    }
    .car {
      background: #1e293b;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      transition: transform 0.3s ease;
    }
    .car:hover {
      transform: scale(1.02);
    }
    .car img {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }
    .car-details {
      padding: 20px;
    }
    .car h3 {
      font-size: 1.4rem;
      color: #ffffff;
      margin-bottom: 10px;
    }
    .car p {
      font-size: 0.95rem;
      color: #cbd5e1;
      margin-bottom: 6px;
    }
    .car button {
      background: #3b82f6;
      color: #ffffff;
      border: none;
      border-radius: 6px;
      padding: 10px 20px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .car button:hover {
      background: #2563eb;
    }
    /* Modal styles */
    .modal-bg {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.6);
      display: flex; align-items: center; justify-content: center;
      z-index: 1000;
      transition: opacity 0.3s;
    }
    .modal {
      background: #1e293b;
      border-radius: 18px;
      max-width: 800px;
      width: 97vw;
      max-height: 95vh;
      overflow-y: auto;
      padding: 30px 24px 20px 24px;
      position: relative;
      color: #fff;
      box-shadow: 0 8px 24px rgba(0,0,0,0.45);
    }
    .modal-close {
      position: absolute;
      top: 12px;
      right: 18px;
      background: none;
      border: none;
      color: #f87171;
      font-size: 2rem;
      cursor: pointer;
    }
    .modal-images {
      display: flex;
      gap: 9px;
      overflow-x: auto;
      margin-bottom: 18px;
    }
    .modal-images img {
      height: 160px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.16);
      object-fit: cover;
      background: #222;
    }
    .modal-details {
      margin-bottom: 18px;
    }
    .modal-details p {
      margin: 6px 0;
      font-size: 1.08rem;
    }
    .modal-actions {
      display: flex;
      gap: 18px;
      justify-content: center;
      margin-top: 15px;
    }
    .modal-actions button {
      background: #3b82f6;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 12px 28px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s;
    }
    .modal-actions button:hover {
      background: #2563eb;
    }
    @media (max-width: 768px) {
      header { flex-direction: column; text-align: center;}
      header img { max-width: 68%;}
      .header-nav { flex-direction: column; gap: 10px;}
      .filters { grid-template-columns: 1fr; }
      .car img { height: 160px; }
      .modal { padding: 15px 7px 10px 7px; }
      .modal-actions button { padding: 10px 8px; font-size: 1rem;}
    }
#modal-bg {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  z-index: 9999;
  justify-content: center;
  align-items: center;
}
.modal {
  background: rgb(71, 10, 141);
  padding: 20px;
  max-width: 800px;
  width: 90%;
  border-radius: 10px;
  position: relative;
}
.modal-close {
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 22px;
  background: transparent;
  border: none;
  cursor: pointer;
}
    .modal-images img {
      max-width: 100%;
      margin: 5px 0;
    }
.swiper {
  width: 100%;
  height: 400px;
}
.swiper-slide img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* Actions */
.modal-actions {
  display: flex;
  gap: 10px;
  margin-top: 15px;
}
  </style>
</head>
<body>
<header>
  <img src="logo1.png" alt="Logo société mère">
  <div class="header-center">
    <h1>P2P-CARS</h1>
    <p class="text-h">Plateforme de Voitures d'Occasion</p>
  </div>
  <img src="logo4.png" alt="Logo plateforme">
</header>
<div class="navbar">
  <div class="lang-btns">
    <button id="lang-fr" aria-label="Français">FR</button>
    <button id="lang-en" aria-label="English">EN</button>
    <button id="lang-ar" aria-label="العربية">AR</button>
  </div>
  <a href="https://p2p-cars.com" class="home-btn"><i class="fas fa-home"></i> Accueil</a>
</div>
<nav class="header-nav">
  <a href="https://p2p-cars.com" id="nav-accueil">Accueil</a>
  <a href="https://p2p-cars.com/esprix" id="nav-simulateur">Simulateur Prix</a>
  <a href="https://p2p-cars.com/carservices" id="nav-services">Services P2P-Cars</a>
  <a href="https://p2p-cars.com/login" id="nav-login">Espace personnel </a>
</nav>
<section class="welcome-section" id="welcome-section">
  <h2 id="welcome-title">Bienvenue sur P2P-CARS</h2>
  <p id="welcome-desc">Découvrez ici les meilleures offres de voitures d'occasion, annoncez la vente de la vôtre en toute simplicité, ou demandez à trouver et à acheter précisément la voiture d'occasion qui correspond à vos besoins...</p>
  <button id="btn">Envoyer une demande</button>
</section>
<section class="filters">
  <label for="search" id="filter-search-label">Rechercher:</label>
  <input type="text" id="search" placeholder="Rechercher...">
  <label for="marque" id="filter-marque-label">Marque:</label>
  <select id="marque"></select>
  <label for="modele" id="filter-modele-label">Modèle:</label>
  <select id="modele"></select>
  <label for="annee" id="filter-annee-label">Année:</label>
  <select id="annee"></select>
  <label for="kilometrage" id="filter-kilometrage-label">Kilométrage max:</label>
  <input type="number" id="kilometrage" placeholder="Kilométrage max">
  <label for="carburant" id="filter-carburant-label">Carburant:</label>
  <select id="carburant"></select>
  <label for="puissance" id="filter-puissance-label">Puissance max (CV):</label>
  <input type="number" id="puissance" placeholder="Puissance max (CV)">
</section>
<section class="car-list" id="carList">
  <!-- Car listings will be dynamically added here -->
</section>
<footer>
  &copy; 2025 IASMarket Services. Tous droits réservés.
</footer>
<!-- Modal structure -->
<div id="modal-bg" style="display:none"></div>


<!-- Swiper JS -->
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script>
const apiURL = "https://apicars.p2p-cars.com/api/getannonce";
const imgBase = "https://apicars.p2p-cars.com/";

const translations = {
  fr: {
    'welcome-title': "Bienvenue sur P2P-CARS",
    'welcome-desc': "Découvrez ici les meilleures offres de voitures d'occasion, annoncez la vente de la vôtre en toute simplicité, ou demandez à trouver et à acheter précisément la voiture d'occasion qui correspond à vos besoins. Profitez également d’un service complet, avant et après la vente ou l’achat, entièrement adapté à vos attentes. Et pour faciliter votre acquisition, bénéficiez de plans de paiement flexibles, le tout dans un cadre de confiance entre particuliers.",
    'btn': "Envoyer une demande",
    'filter-search-label': "Rechercher:",
    'filter-search-ph': "Rechercher...",
    'filter-marque-label': "Marque:",
    'filter-marque-ph': "Choisir une marque",
    'filter-modele-label': "Modèle:",
    'filter-modele-ph': "Choisir un modèle",
    'filter-annee-label': "Année:",
    'filter-annee-ph': "Année",
    'filter-kilometrage-label': "Kilométrage max:",
    'filter-kilometrage-ph': "Kilométrage max",
    'filter-carburant-label': "Carburant:",
    'filter-carburant-ph': "Carburant",
    'filter-puissance-label': "Puissance max (CV):",
    'filter-puissance-ph': "Puissance max (CV)",
    'home': "Accueil",
    'nav-accueil': "Accueil",
    'nav-simulateur': "Simulateur Prix",
    'nav-services': "Services P2P-Cars",
    'nav-login':"Espace personnel",
    'brands': ["Renault", "Peugeot", "Toyota"],
    'models': {
      Renault: ["Clio", "Mégane", "Captur"],
      Peugeot: ["208", "308", "2008"],
      Toyota: ["Yaris", "Corolla", "C-HR"]
    },
    'fuels': ["Essence", "Diesel", "Hybride", "Électrique"],
    'cars': [
      {
        marque: "Renault",
        modele: "Clio",
        annee: "2015",
        kilometrage: 120000,
        carburant: "Essence",
        puissance: 5,
        image: "images/clio.jpg",
        description: "Petite citadine fiable et économique."
      }
    ],
    'consult-btn': "Consulter",
    'modal-title': "Détails de la voiture",
    'modal-close': "Fermer",
    'modal-contact': "Contacter le vendeur",
    'modal-buy': "Demander l'achat P2P",
    'modal-date': "Date de mise en ligne",
    'modal-marque': "Marque",
    'modal-modele': "Modèle",
    'modal-annee': "Année",
    'modal-puissance': "Puissance fiscale",
    'modal-kilometrage': "Kilométrage",
    'modal-carburant': "Carburant",
    'modal-transmission': "Transmission",
    'modal-desc': "Description",
    'modal-price': "Prix"
  },
  en: {
    'welcome-title': "Welcome to P2P-CARS",
    'welcome-desc': "Discover the best offers for used cars here, easily announce the sale of your vehicle, or request to find and purchase the exact used car that meets your needs. Enjoy comprehensive services before and after the sale or purchase, fully tailored to your expectations. And to make your acquisition easier, benefit from flexible payment plans, all within a trusted private-to-private environment.",
    'btn': "Send a request",
    'filter-search-label': "Search:",
    'filter-search-ph': "Search...",
    'filter-marque-label': "Brand:",
    'filter-marque-ph': "Choose a brand",
    'filter-modele-label': "Model:",
    'filter-modele-ph': "Choose a model",
    'filter-annee-label': "Year:",
    'filter-annee-ph': "Year",
    'filter-kilometrage-label': "Max mileage:",
    'filter-kilometrage-ph': "Max mileage",
    'filter-carburant-label': "Fuel:",
    'filter-carburant-ph': "Fuel",
    'filter-puissance-label': "Max power (HP):",
    'filter-puissance-ph': "Max power (HP)",
    'home': "Home",
    'nav-accueil': "Home",
    'nav-simulateur': "Price calculator",
    'nav-services': "P2P-Cars Services",
    'nav-login':"Personal Space",
    'brands': ["Renault", "Peugeot", "Toyota"],
    'models': {
      Renault: ["Clio", "Megane", "Captur"],
      Peugeot: ["208", "308", "2008"],
      Toyota: ["Yaris", "Corolla", "C-HR"]
    },
    'fuels': ["Petrol", "Diesel", "Hybrid", "Electric"],
    'cars': [
      {
        marque: "Renault",
        modele: "Clio",
        annee: "2015",
        kilometrage: 120000,
        carburant: "Petrol",
        puissance: 5,
        image: "images/clio.jpg",
        description: "Reliable and economical city car."
      }
    ],
    'consult-btn': "View details",
    'modal-title': "Car details",
    'modal-close': "Close",
    'modal-contact': "Contact seller",
    'modal-buy': "Request P2P purchase",
    'modal-date': "Online since",
    'modal-marque': "Brand",
    'modal-modele': "Model",
    'modal-annee': "Year",
    'modal-puissance': "Fiscal power",
    'modal-kilometrage': "Mileage",
    'modal-carburant': "Fuel",
    'modal-transmission': "Transmission",
    'modal-desc': "Description",
    'modal-price': "Price"
  },
  ar: {
    'welcome-title': "مرحبا بكم في P2P-CARS",
    'welcome-desc': "اكتشف أفضل عروض السيارات المستعملة هنا، أعلن عن بيع سيارتك بكل سهولة، أو اطلب العثور على وشراء السيارة المستعملة التي تناسب احتياجاتك بدقة. استمتع بخدمات شاملة قبل وبعد البيع أو الشراء، مصممة بالكامل لتلبية توقعاتك. ولتسهيل عملية الشراء، استفد من خطط دفع مرنة، وكل ذلك في بيئة موثوقة بين الأفراد.",
    'btn': "إرسال طلب",
    'filter-search-label': "بحث:",
    'filter-search-ph': "بحث...",
    'filter-marque-label': "الماركة:",
    'filter-marque-ph': "اختر ماركة",
    'filter-modele-label': "الموديل:",
    'filter-modele-ph': "اختر موديل",
    'filter-annee-label': "السنة:",
    'filter-annee-ph': "السنة",
    'filter-kilometrage-label': "الحد الأقصى للكيلومترات:",
    'filter-kilometrage-ph': "أقصى كيلومترات",
    'filter-carburant-label': "الوقود:",
    'filter-carburant-ph': "الوقود",
    'filter-puissance-label': "أقصى قوة (CV):",
    'filter-puissance-ph': "أقصى قوة (CV)",
    'home': "الرئيسية",
    'nav-accueil': "الرئيسية",
    'nav-simulateur': "حساب السعر",
    'nav-services': "خدمات P2P-Cars",
    'nav-login':"الفضاء الشخصي",
    'brands': ["رينو", "بيجو", "تويوتا"],
    'models': {
      "رينو": ["كليو", "ميجان", "كابتور"],
      "بيجو": ["208", "308", "2008"],
      "تويوتا": ["ياريس", "كورولا", "سي-إتش آر"]
    },
    'fuels': ["بنزين", "ديزل", "هايبرد", "كهرباء"],
    'cars': [
      {
        marque: "رينو",
        modele: "كليو",
        annee: "2015",
        kilometrage: 120000,
        carburant: "بنزين",
        puissance: 5,
        image: "images/clio.jpg",
        description: "سيارة مدينة موثوقة واقتصادية."
      }
    ],
    'consult-btn': "معاينة التفاصيل",
    'modal-title': "تفاصيل السيارة",
    'modal-close': "إغلاق",
    'modal-contact': "اتصل بالبائع",
    'modal-buy': "طلب شراء P2P",
    'modal-date': "تاريخ النشر",
    'modal-marque': "الماركة",
    'modal-modele': "الموديل",
    'modal-annee': "السنة",
    'modal-puissance': "القوة الجبائية",
    'modal-kilometrage': "الكيلومترات",
    'modal-carburant': "الوقود",
    'modal-transmission': "ناقل الحركة",
    'modal-desc': "الوصف",
    'modal-price': "السعر"
  }
};

let currentLang = "fr";
function setLang(lang) {
  currentLang = lang;
  document.documentElement.lang = lang;
  document.body.style.direction = (lang === 'ar' ? 'rtl' : 'ltr');
  [
    'welcome-title','welcome-desc','btn','filter-search-label','filter-marque-label',
    'filter-modele-label','filter-annee-label','filter-kilometrage-label',
    'filter-carburant-label','filter-puissance-label',
    'nav-accueil','nav-simulateur','nav-services','nav-login'
  ].forEach(id => {
    let el = document.getElementById(id);
    if (el && translations[lang][id]) el.textContent = translations[lang][id];
  });
  document.querySelector('.home-btn').innerHTML = `<i class="fas fa-home"></i> ${translations[lang]['home']}`;
  ['fr','en','ar'].forEach(l=>{
    document.getElementById('lang-'+l).classList.remove('active');
  });
  document.getElementById('lang-'+lang).classList.add('active');
  document.getElementById('search').placeholder = translations[lang]['filter-search-ph'];
  document.getElementById('kilometrage').placeholder = translations[lang]['filter-kilometrage-ph'];
  document.getElementById('puissance').placeholder = translations[lang]['filter-puissance-ph'];
  let marqueSel = document.getElementById('marque');
  marqueSel.innerHTML = `<option value="">${translations[lang]['filter-marque-ph']}</option>` +
    translations[lang]['brands'].map(m=>`<option value="${m}">${m}</option>`).join('');
  fillModelSelect();
  let anneeSel = document.getElementById('annee');
  anneeSel.innerHTML = `<option value="">${translations[lang]['filter-annee-ph']}</option>`;
  for (let y = new Date().getFullYear(); y >= 2000; y--) {
    anneeSel.innerHTML += `<option value="${y}">${y}</option>`;
  }
  let carburantSel = document.getElementById('carburant');
  carburantSel.innerHTML = `<option value="">${translations[lang]['filter-carburant-ph']}</option>` +
    translations[lang]['fuels'].map(f=>`<option value="${f}">${f}</option>`).join('');
  displayCars();
}
;

function fillModelSelect() {
  let marque = document.getElementById('marque').value;
  let modeleSel = document.getElementById('modele');
  modeleSel.innerHTML = `<option value="">${translations[currentLang]['filter-modele-ph']}</option>`;
  if (translations[currentLang]['models'][marque]) {
    translations[currentLang]['models'][marque].forEach(m => {
      modeleSel.innerHTML += `<option value="${m}">${m}</option>`;
    });
  }
}

function transformResponseToArray(data) {
  const keys = Object.keys(data);
  if (keys.length === 0) return [];

  const length = data[keys[0]].length;
  const result = [];

  for (let i = 0; i < length; i++) {
    const obj = {};
    keys.forEach(key => {
      obj[key] = data[key][i];
    });
    result.push(obj);
  }

  return result;
}


function displayCars() {
  const search = document.getElementById("search").value.toLowerCase();
  const marque = document.getElementById("marque").value;
  const modele = document.getElementById("modele").value;
  const annee = document.getElementById("annee").value;
  const kilometrage = document.getElementById("kilometrage").value;
  const carburant = document.getElementById("carburant").value;
  const puissance = document.getElementById("puissance").value;

  const postData = { search, marque, modele, annee, kilometrage, carburant, puissance };

  fetch(apiURL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(postData)
  })
    .then(res => {
      if (!res.ok) throw new Error("Erreur serveur : " + res.status);
      return res.json();
    })
    .then(data => {
      const annonces = transformResponseToArray(data);

      const filtered = annonces.filter(c => {
        return (
          (search === "" || (c.marque && c.marque.toLowerCase().includes(search)) || (c.modele && c.modele.toLowerCase().includes(search))) &&
          (marque === "" || c.marque === marque) &&
          (modele === "" || c.modele === modele) &&
          (annee === "" || c.annee == annee) &&
          (kilometrage === "" || (c.kilometrage && c.kilometrage <= parseInt(kilometrage))) &&
          (carburant === "" || c.carburant === carburant) &&
          (puissance === "" || (c.cv && c.cv <= parseInt(puissance)))
        );
      });

      const list = document.getElementById("carList");
      list.innerHTML = "";

      filtered.forEach(c => {
        const div = document.createElement("div");
        div.className = "car";

        // Conversion des chemins d'images
        let imagesArr = typeof c.images === "string"
          ? c.images.split(/;|,/).map(img => "https://p2p-cars.com/" + img.replace(/\\/g, "/"))
          : Array.isArray(c.images) ? c.images.map(img => "https://p2p-cars.com/" + img.replace(/\\/g, "/")) : [];

        let imgLink = imagesArr.length > 0 ? imagesArr[0] : "images/default.jpg";

        div.innerHTML = `
          <img src="${imgLink}" alt="${c.marque || ""} ${c.modele || ""}">
          <div class="car-details">
            <h3>${c.marque || ""} ${c.modele || ""} (${c.annee || ""})</h3>
            <p><strong>Kilométrage:</strong> ${c.kilometrage || ""} km</p>
            <p><strong>Carburant:</strong> ${c.carburant || ""}</p>
            <p><strong>Puissance fiscale:</strong> ${c.cv || ""}</p>
            <p><strong>Prix:</strong> ${c.prix ? c.prix + " €" : ""}</p>
            <p>${c.description || ""}</p>
            <button class="consult-btn" data-index="${c.Ref || ""}" style="margin-top:8px;">Consulter</button>
          </div>
        `;

        list.appendChild(div);

        div.querySelector(".consult-btn").addEventListener("click", () => openModal(c));
      });
    })
    .catch(err => {
      console.error("Erreur lors du chargement :", err);
      fallbackDisplayCars();
    });
}

function fallbackDisplayCars() {
  const cars = translations[currentLang]['cars'];
  const list = document.getElementById("carList");

  const search = document.getElementById("search").value.toLowerCase();
  const marque = document.getElementById("marque").value;
  const modele = document.getElementById("modele").value;
  const annee = document.getElementById("annee").value;
  const kilometrage = document.getElementById("kilometrage").value;
  const carburant = document.getElementById("carburant").value;
  const puissance = document.getElementById("puissance").value;

  const filtered = cars.filter(c => {
    return (
      (search === "" || c.marque.toLowerCase().includes(search) || c.modele.toLowerCase().includes(search)) &&
      (marque === "" || c.marque === marque) &&
      (modele === "" || c.modele === modele) &&
      (annee === "" || c.annee === annee) &&
      (kilometrage === "" || c.kilometrage <= parseInt(kilometrage || Infinity)) &&
      (carburant === "" || c.carburant === carburant) &&
      (puissance === "" || c.puissance <= parseInt(puissance || Infinity))
    );
  });

  list.innerHTML = "";

  filtered.forEach(c => {
    const div = document.createElement("div");
    div.className = "car";

    // Conversion images fallback
    let imagesArr = typeof c.image === "string"
      ? c.image.split(/;|,/).map(img => "https://p2p-cars.com/" + img.replace(/\\/g, "/"))
      : ["images/default.jpg"];

    div.innerHTML = `
      <img src="${imagesArr[0]}" alt="${c.marque} ${c.modele}">
      <div class="car-details">
        <h3>${c.marque} ${c.modele} (${c.annee})</h3>
        <p><strong>${translations[currentLang]['filter-kilometrage-label']}</strong> ${c.kilometrage} km</p>
        <p><strong>${translations[currentLang]['filter-carburant-label']}</strong> ${c.carburant}</p>
        <p><strong>${translations[currentLang]['filter-puissance-label']}</strong> ${c.puissance}</p>
        <p>${c.description}</p>
        <button class="consult-btn">${translations[currentLang]['consult-btn']}</button>
      </div>
    `;
    list.appendChild(div);
    div.querySelector(".consult-btn").addEventListener("click", () => openModal(c));
  });
}

function openModal(car) {
  let imagesArr = Array.isArray(car.images)
    ? car.images
    : (typeof car.images === "string" ? car.images.split(/[,;]/) : []);

  // On préfixe avec ton domaine
  imagesArr = imagesArr.map(img =>
    "https://p2p-cars.com/" + img.replace(/\\/g, "/")
  );

  let priceStr = car.prix ? car.prix + " €" : "";

  let modalBg = document.getElementById("modal-bg");

  modalBg.innerHTML = `
    <div class="modal">
      <button class="modal-close" aria-label="Fermer">&times;</button>
      <h2>${car.marque || ""} ${car.modele || ""} (${car.annee || ""})</h2>
      
      <!-- Swiper -->
      <div class="swiper">
        <div class="swiper-wrapper">
          ${imagesArr.map(img => `<div class="swiper-slide"><img src="${img}" alt=""></div>`).join("")}
        </div>
        <div class="swiper-pagination"></div>
        <div class="swiper-button-prev"></div>
        <div class="swiper-button-next"></div>
      </div>

      <div class="modal-details">
        <p><strong>Date:</strong> ${car.date || ""}</p>
        <p><strong>Kilométrage:</strong> ${car.kilometrage || ""} km</p>
        <p><strong>Carburant:</strong> ${car.carburant || ""}</p>
        <p><strong>Puissance fiscale:</strong> ${car.cv || ""}</p>
        <p><strong>Prix:</strong> ${priceStr}</p>
        <p>${car.description || ""}</p>
      </div>

      <div class="modal-actions">
        <button id="contact-btn">Contact</button>
        <button id="buy-btn">Acheter</button>
      </div>
    </div>
  `;

  modalBg.style.display = "flex";

  // Fermer modal
  modalBg.querySelector(".modal-close").onclick = () => modalBg.style.display = "none";
  modalBg.onclick = (e) => {
    if (e.target === modalBg) modalBg.style.display = "none";
  };

  // Actions boutons avec Ref
  document.getElementById("contact-btn").onclick = function () {
    alert("Contact vendeur - Ref : " + (car.Ref || "N/A"));
  };
  document.getElementById("buy-btn").onclick = function () {
    alert("Acheter cette voiture - Ref : " + (car.Ref || "N/A"));
  };

  // Init Swiper
  new Swiper(".swiper", {
    loop: true,
    pagination: { el: ".swiper-pagination", clickable: true },
    navigation: { nextEl: ".swiper-button-next", prevEl: ".swiper-button-prev" }
  });
}

// Écouteurs sur les filtres
document.getElementById("marque").addEventListener("change", () => {
  fillModelSelect();
  displayCars();
});
document.getElementById("modele").addEventListener("change", displayCars);
document.getElementById("annee").addEventListener("change", displayCars);
document.getElementById("kilometrage").addEventListener("input", displayCars);
document.getElementById("carburant").addEventListener("change", displayCars);
document.getElementById("puissance").addEventListener("input", displayCars);
document.getElementById("search").addEventListener("input", displayCars);
['fr','en','ar'].forEach(l=>{
  document.getElementById('lang-'+l).addEventListener('click', ()=>setLang(l));
});
setLang('fr');
document.getElementById('btn').addEventListener('click', function() {
  window.location.href = 'https://p2p-cars.com/carservices';
});
</script>

</body>
</html>
